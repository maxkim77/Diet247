<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://maxkim77.github.io/Diet247/common.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
    .center-button {
    display: block;
    margin: 20px auto; /* 위 아래로 20px의 여백을 주고, 좌우는 자동으로 설정하여 중앙에 배치 */
    }
    </style>
    <title>Diet 24/7</title>
</head>
<body>
<!-- Header  -->
    <header class="layout-header">
        <img src="https://maxkim77.github.io/Diet247/IMG/img2.png" width="150px" height="150px">
        <img src="https://maxkim77.github.io/Diet247/IMG/img3.png" width="80px" height="50px">
    </header>
<!-- 사이드메뉴 -->
<div class="left-menu">
    <img src="https://maxkim77.github.io/Diet247/IMG/img1.png" width="200" height="200">
    <ul>
<li><a href="https://maxkim77.github.io/Diet247-1/">Home</a></li>
<li><a href="https://maxkim77.github.io/Diet247/">Diet Plan</a></li>
<li><a href="https://maxkim77.github.io/Diet247-section1/">Food Info</a></li>
<li><a href="https://maxkim77.github.io/Diet247-section2/">Communication</a></li>
<li><a href="https://maxkim77.github.io/Diet247-section3/">Contact Point</a></li>
    </ul>
</div>
<!-- 사이드메뉴 -->

    <div class="container">
        <div class="image-container"><img src="https://maxkim77.github.io/Diet247/IMG/index.PNG" alt="Diet Image"></div>
        <div class="text-container">
            <h2>[다이어트 식단]</h2>
            <form id="diet-form">
                <div>무슨 운동 하시나요?</div>
                <input name="type" id="type" type="text" minlength="2" maxlength="30" placeholder="수영, 헬스, 축구, 야구 등" required>
                <div>며칠 동안 식단관리를 할 건가요?</div>
                <input name="days" id="days" type="text" minlength="2" maxlength="30" placeholder="3일" required>
                <div>못 먹는 음식이 있나요?</div>
                <input name="extrafood" id="extrafood" type="text" minlength="2" maxlength="30" placeholder="피클, 땅콩 등" required>
                <div>다이어트 목적은 있나요?</div>
                <div class="field" >
                    <ul>
                        <input id="work1" value="work1" type="checkbox">
                        <label for="work1">체중증가</label>
                    </ul>
                    <ul>
                        <input id="work2" value="work2" type="checkbox">
                        <label for="work2">체중감량</label>
                    </ul>
                    <ul>
                        <input id="work3" value="work3" type="checkbox">
                        <label for="work3">체중유지</label>
                    </ul>
                    <ul>
                        <input id="work4" value="work4" type="checkbox">
                        <label for="work4">근육증가</label>
                    </ul>
                </div>
                <button type="submit">질문하기!</button>
            </form>
        </div>
    <div id="loading" style="display: none;">
        <h2>It's a work in the progress.</h2>
        <img src = "https://maxkim77.github.io/Diet247/IMG/load-32_256.gif">
    </div>

    <div id="result" style="display: none;">
        <h2 style="text-align: center;">[식단일정]</h2>
        <div class="frame-container"></div>
        <button class="center-button" onclick="init()">Home</button>
        <button id="exportBtn">내보내기</button>


    </div>
</div>
<main>
</main>

<script>
function init() {
    $('.image-container').show();
    $('#main').show();
    $('#loading').hide();
    $('#result').hide();
}

const url = `https://estsoft-openai-api.jejucodingcamp.workers.dev/`;
const $form = $('#diet-form');
const $frameContainer = $('.frame-container');

$form.on('submit', async function(e) {
    e.preventDefault();

    const type = $('#type').val();
    const days = $('#days').val();
    const extrafood = $('#extrafood').val();
    const work1 = $('#work1').prop('checked');
    const work2 = $('#work2').prop('checked');
    const work3 = $('#work3').prop('checked');
    const work4 = $('#work4').prop('checked');

    let purpose = '';
    if (work1) purpose += '체중증가 ';
    if (work2) purpose += '체중감량 ';
    if (work3) purpose += '체중유지 ';
    if (work4) purpose += '근육증가 ';

    const data = {
        "role": "system",
        "content": `운동 종류: ${type}, 식단 기간: ${days}, 못 먹는 음식: ${extrafood}, 목적: ${purpose} 등을 활용해서 운동식단을 짜드리겠습니다.`
    };
    $('.image-container').hide();
    $('#main').hide();
    $('#loading').show();

    try {
        const response = await fetch(url, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify([data]),
            redirect: 'follow'
        });

        const result = await response.json();
        const numDays = parseInt(days, 10) || 1;

        $frameContainer.empty(); // 기존 내용 삭제

        for (let i = 1; i <= numDays; i++) {
            const frame = $('<div>').addClass('frame');
            frame.html(`
                <h3>Day ${i}</h3>
                <p>${result.choices[0].message.content}</p>
            `);
            $frameContainer.append(frame);
        }

        $('#loading').hide();
        $('#result').show();
    } catch (error) {
        console.error("Error fetching data:", error);
        $('#loading').hide();
        $('#main').show();
        alert("An error occurred. Please try again.");
    }
});
document.getElementById('exportBtn').addEventListener('click', function() {
    const blob = new Blob([document.documentElement.outerHTML], { type: 'text/html' });
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.style.display = 'none';
    a.href = url;
    a.download = 'diet_schedule.html'; // 원하는 파일명을 설정하세요.

    document.body.appendChild(a);
    a.click();

    window.URL.revokeObjectURL(url);
});
    
</script>

<!-- 하단부분 -->
       <footer class="layout-footer">
        Copyright 2023. CHILLI All rights reserved.
    </footer>
<!-- 하단부분 -->

</body>
</html>
